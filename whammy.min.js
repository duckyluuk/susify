window.Whammy=function(){function t(t,a){for(var e,i=function t(a){for(var e=a[0].width,i=a[0].height,n=a[0].duration,r=1;r<a.length;r++){if(a[r].width!=e)throw"Frame "+(r+1)+" has a different width";if(a[r].height!=i)throw"Frame "+(r+1)+" has a different height";if(a[r].duration<0||a[r].duration>32767)throw"Frame "+(r+1)+" has a weird duration (must be between 0 and 32767)";n+=a[r].duration}return{duration:n,width:e,height:i}}(t),n=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:(e=i.duration,[].slice.call(new Uint8Array(new Float64Array([e]).buffer),0).map(function(t){return String.fromCharCode(t)}).reverse().join("")),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:i.width,id:176},{data:i.height,id:186}]}]}]},{id:475249515,data:[]}]}],d=n[1],o=d.data[2],f=0,h=0;f<t.length;){var $={id:187,data:[{data:Math.round(h),id:179},{id:183,data:[{data:1,id:247},{data:0,size:8,id:241}]}]};o.data.push($);var s=[],c=0;do s.push(t[f]),c+=t[f].duration,f++;while(f<t.length&&c<3e4);var g=0,m={id:524531317,data:[{data:Math.round(h),id:231}].concat(s.map(function(t){var a=u({discardable:0,frame:t.data.slice(t.data.indexOf('\x9d\x01\x2a') - 3),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(g)});return g+=t.duration,{data:a,id:163}}))};d.data.push(m),h+=c}for(var l=0,p=0;p<d.data.length;p++){p>=3&&(o.data[p-3].data[1].data[1].data=l);var v=r([d.data[p]],a);l+=v.size||v.byteLength||v.length,2!=p&&(d.data[p]=v)}return r(n,a)}function a(t){for(var a=[];t>0;)a.push(255&t),t>>=8;return new Uint8Array(a.reverse())}function e(t,a){for(var e=new Uint8Array(a),i=a-1;i>=0;i--)e[i]=255&t,t>>=8;return e}function i(t){for(var a=new Uint8Array(t.length),e=0;e<t.length;e++)a[e]=t.charCodeAt(e);return a}function n(t){var a=[];t=(t.length%8?Array(9-t.length%8).join("0"):"")+t;for(var e=0;e<t.length;e+=8)a.push(parseInt(t.substr(e,8),2));return new Uint8Array(a)}function r(t,d){for(var o=[],u=0;u<t.length;u++){if(!("id"in t[u])){o.push(t[u]);continue}var f=t[u].data;if("object"==typeof f&&(f=r(f,d)),"number"==typeof f&&(f="size"in t[u]?e(f,t[u].size):n(f.toString(2))),"string"==typeof f&&(f=i(f)),f.length)var h=h;var $=f.size||f.byteLength||f.length,s=Math.ceil(Math.ceil(Math.log($)/Math.log(2))/8),c=$.toString(2),g=Array(7*s+7+1-c.length).join("0")+c,m=Array(s).join("0")+"1"+g;o.push(a(t[u].id)),o.push(n(m)),o.push(f)}if(!d)return new Blob(o,{type:"video/webm"});var l=function t(a,e){null==e&&(e=[]);for(var i=0;i<a.length;i++)"object"==typeof a[i]?t(a[i],e):e.push(a[i]);return e}(o);return new Uint8Array(l)}function d(t){var a="";t=(t.length%8?Array(9-t.length%8).join("0"):"")+t;for(var e=0;e<t.length;e+=8)a+=String.fromCharCode(parseInt(t.substr(e,8),2));return a}function o(t){for(var a="",e=0;e<t.length;e++){var i=t[e].data;"object"==typeof i&&(i=o(i)),"number"==typeof i&&(i=d(i.toString(2)));var n=i.length,r=Math.ceil(Math.ceil(Math.log(n)/Math.log(2))/8),u=n.toString(2),f=Array(7*r+7+1-u.length).join("0")+u,h=Array(r).join("0")+"1"+f;a+=d(t[e].id.toString(2))+d(h)+i}return a}function u(t){var a=0;if(t.keyframe&&(a|=128),t.invisible&&(a|=8),t.lacing&&(a|=t.lacing<<1),t.discardable&&(a|=1),t.trackNum>127)throw"TrackNumber > 127 not supported";return[128|t.trackNum,t.timecode>>8,255&t.timecode,a].map(function(t){return String.fromCharCode(t)}).join("")+t.frame}function f(t){for(var a,e,i,n,r,d=t.RIFF[0].WEBP[0],o=d.indexOf("\x9d\x01*"),u=0,f=[];u<4;u++)f[u]=d.charCodeAt(o+3+u);return a=16383&(r=f[1]<<8|f[0]),e=r>>14,i=16383&(r=f[3]<<8|f[2]),n=r>>14,{width:a,height:i,data:d,riff:t}}function h(t){for(var a=0,e={};a<t.length;){var i=t.substr(a,4);if(e[i]=e[i]||[],"RIFF"==i||"LIST"==i){var n=parseInt(t.substr(a+4,4).split("").map(function(t){var a=t.charCodeAt(0).toString(2);return Array(8-a.length+1).join("0")+a}).join(""),2),r=t.substr(a+4+4,n);a+=8+n,e[i].push(h(r))}else"WEBP"==i?(e[i].push(t.substr(a+8)),a=t.length):(e[i].push(t.substr(a+4)),a=t.length)}return e}function $(t,a){this.frames=[],this.duration=1e3/t,this.quality=a||.8}return $.prototype.add=function(t,a){if(void 0!==a&&this.duration)throw"you can't pass a duration if the fps is set";if(void 0===a&&!this.duration)throw"if you don't have the fps set, you need to have durations here.";if(t.canvas&&(t=t.canvas),t.toDataURL)t=t.getContext("2d").getImageData(0,0,t.width,t.height);else if("string"!=typeof t)throw"frame must be a a HTMLCanvasElement, a CanvasRenderingContext2D or a DataURI formatted string";if("string"==typeof t&&!/^data:image\/webp;base64,/ig.test(t))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:t,duration:a||this.duration})},$.prototype.encodeFrames=function(t){if(this.frames[0].image instanceof ImageData){var a=this.frames,e=document.createElement("canvas"),i=e.getContext("2d");e.width=this.frames[0].image.width,e.height=this.frames[0].image.height;var n=(function(r){progress.innerHTML=r;console.log("encodeFrame",r);var d=a[r];i.putImageData(d.image,0,0),d.image=e.toDataURL("image/webp",this.quality),r<a.length-1?setTimeout(function(){n(r+1)},1):t()}).bind(this);n(0)}else t()},$.prototype.compile=function(a,e){this.encodeFrames((function(){e(new t(this.frames.map(function(t){var a=f(h(atob(t.image.slice(23))));return a.duration=t.duration,a}),a))}).bind(this))},{Video:$,fromImageArray:function(a,e,i){return t(a.map(function(t){var a=f(h(atob(t.slice(23))));return a.duration=1e3/e,a}),i)},toWebM:t}}();